<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Carpetas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .search-container input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }

        .folder {
            border: 1px solid #ddd;
            margin: 10px 0;
            border-radius: 4px;
            overflow: hidden;
        }

        .folder-header {
            background: #f8f9fa;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-content {
            display: none;
            padding: 15px;
            background: white;
        }

        .folder-content.active {
            display: block;
        }

        .pdf-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .pdf-list li {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .pdf-list li:last-child {
            border-bottom: none;
        }

        .pdf-list a {
            color: #007bff;
            text-decoration: none;
        }

        .pdf-list a:hover {
            text-decoration: underline;
        }

        .admin-controls {
            text-align: right;
            margin-bottom: 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .folder-actions {
            display: none;
        }

        .admin-mode .folder-actions {
            display: block;
        }

        #error-message {
            color: red;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RESUMENES MENSAJES BIBLICOS</h1>
        
        <div class="admin-controls">
            <button id="adminLoginBtn" class="btn btn-primary">Modo Administrador</button>
            <button id="logoutBtn" class="btn btn-danger" style="display: none;">Cerrar Sesión</button>
            <button id="addFolderBtn" class="btn btn-primary" style="display: none;">Agregar Carpeta</button>
        </div>

        <div class="search-container">
            <input type="text" id="search1" placeholder="Palabra clave 1" onkeyup="searchPDFs()">
            <input type="text" id="search2" placeholder="Palabra clave 2" onkeyup="searchPDFs()">
            <input type="text" id="search3" placeholder="Palabra clave 3" onkeyup="searchPDFs()">
        </div>

        <div id="folders-container"></div>

        <p id="error-message"></p>
    </div>

    <!-- Modal de Admin Login -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2>Acceso Administrador</h2>
            <div class="form-group">
                <label>Contraseña:</label>
                <input type="password" id="adminPassword">
            </div>
            <button class="btn btn-primary" onclick="verifyAdminPassword()">Acceder</button>
            <button class="btn btn-danger" onclick="closeModal('adminModal')">Cancelar</button>
        </div>
    </div>

    <!-- Modal de Nueva Carpeta -->
    <div id="folderModal" class="modal">
        <div class="modal-content">
            <h2>Nueva Carpeta</h2>
            <div class="form-group">
                <label>Nombre de la carpeta:</label>
                <input type="text" id="folderName">
            </div>
            <div class="form-group">
                <label>URL del Script de Google:</label>
                <input type="text" id="scriptUrl">
            </div>
            <div class="form-group">
                <label>Contraseña de la carpeta:</label>
                <input type="password" id="folderPassword">
            </div>
            <button class="btn btn-primary" onclick="saveFolder()">Guardar</button>
            <button class="btn btn-danger" onclick="closeModal('folderModal')">Cancelar</button>
        </div>
    </div>

    <!-- Modal de Verificación -->
    <div id="verifyModal" class="modal">
        <div class="modal-content">
            <h2>Verificar Acceso</h2>
            <div class="form-group">
                <label>Contraseña de la carpeta:</label>
                <input type="password" id="verifyPassword">
            </div>
            <button class="btn btn-primary" onclick="verifyFolderAccess()">Verificar</button>
            <button class="btn btn-danger" onclick="closeModal('verifyModal')">Cancelar</button>
        </div>
    </div>

    <script>
        // Configuración
        const ADMIN_PASSWORD = 'admin123'; // Cambiar en producción
        let isAdminMode = false;
        let currentFolderId = null;
        let pendingAction = null;

        // Obtener folders guardados
        let folders = JSON.parse(localStorage.getItem('folders')) || {};

        // Event Listeners
        document.getElementById('adminLoginBtn').addEventListener('click', () => openModal('adminModal'));
        document.getElementById('logoutBtn').addEventListener('click', logoutAdmin);
        document.getElementById('addFolderBtn').addEventListener('click', () => openModal('folderModal'));

        // Funciones principales
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            clearModalInputs(modalId);
        }

        function clearModalInputs(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelectorAll('input').forEach(input => input.value = '');
        }

        function verifyAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminMode = true;
                document.body.classList.add('admin-mode');
                document.getElementById('addFolderBtn').style.display = 'inline-block';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('adminLoginBtn').style.display = 'none';
                closeModal('adminModal');
                localStorage.setItem('adminMode', 'true');
            } else {
                alert('Contraseña incorrecta');
            }
        }

        function logoutAdmin() {
            isAdminMode = false;
            document.body.classList.remove('admin-mode');
            document.getElementById('addFolderBtn').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('adminLoginBtn').style.display = 'inline-block';
            localStorage.removeItem('adminMode');
        }

        function saveFolder() {
            const name = document.getElementById('folderName').value;
            const script = document.getElementById('scriptUrl').value;
            const password = document.getElementById('folderPassword').value;

            if (!name || !script || !password) {
                alert('Por favor complete todos los campos');
                return;
            }

            const folderId = currentFolderId || `folder-${Date.now()}`;
            folders[folderId] = {
                name,
                script,
                password,
                pdfs: []
            };

            localStorage.setItem('folders', JSON.stringify(folders));
            closeModal('folderModal');
            renderFolders();
        }

        function deleteFolder(folderId) {
            delete folders[folderId];
            localStorage.setItem('folders', JSON.stringify(folders));
            renderFolders();
        }

        function showVerifyModal(folderId, action) {
            currentFolderId = folderId;
            pendingAction = action;
            openModal('verifyModal');
        }

        async function verifyFolderAccess() {
            const password = document.getElementById('verifyPassword').value;
            const folder = folders[currentFolderId];

            if (password === folder.password) {
                closeModal('verifyModal');
                if (pendingAction === 'open') {
                    await loadFolderContent(currentFolderId);
                } else if (pendingAction === 'delete') {
                    deleteFolder(currentFolderId);
                }
            } else {
                alert('Contraseña incorrecta');
            }
        }

        async function loadFolderContent(folderId) {
            const folder = folders[folderId];
            const contentDiv = document.getElementById(`content-${folderId}`);
            
            try {
                const response = await fetch(folder.script);
                if (!response.ok) throw new Error('Error al cargar los PDFs');
                const pdfs = await response.json();
                
                folder.pdfs = pdfs;
                renderPDFs(folderId);
                contentDiv.classList.add('active');
            } catch (error) {
                document.getElementById('error-message').textContent = 
                    `Error al cargar los PDFs: ${error.message}`;
            }
        }

        function renderPDFs(folderId) {
            const folder = folders[folderId];
            const contentDiv = document.getElementById(`content-${folderId}`);
            const pdfList = document.createElement('ul');
            pdfList.className = 'pdf-list';

            folder.pdfs.forEach(pdf => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = pdf.url;
                a.textContent = pdf.name;
                a.target = '_blank';
                li.appendChild(a);
                pdfList.appendChild(li);
            });

            contentDiv.innerHTML = '';
            contentDiv.appendChild(pdfList);
        }

        function renderFolders() {
            const container = document.getElementById('folders-container');
            container.innerHTML = '';

            Object.entries(folders).forEach(([id, folder], index) => {
                const folderDiv = document.createElement('div');
                folderDiv.className = 'folder';
                folderDiv.innerHTML = `
                    <div class="folder-header">
                        <span>${index + 1}. ${folder.name}</span>
                        <div class="folder-actions">
                            ${isAdminMode ? 
                                `<button class="btn btn-danger" onclick="showVerifyModal('${id}', 'delete')">
                                    Eliminar
                                </button>` : ''
                            }
                            <button class="btn btn-primary" onclick="showVerifyModal('${id}', 'open')">
                                Abrir
                            </button>
                        </div>
                    </div>
                    <div id="content-${id}" class="folder-content"></div>
                `;
                container.appendChild(folderDiv);
            });
        }

        function searchPDFs() {
            const search1 = document.getElementById('search1').value.toLowerCase();
            const search2 = document.getElementById('search2').value.toLowerCase();
            const search3 = document.getElementById('search3').value.toLowerCase();
            const terms = [search1, search2, search3].filter(term => term);

            Object.entries(folders).forEach(([id, folder]) => {
                const contentDiv = document.getElementById(`content-${id}`);
                if (!contentDiv) return;

                const pdfItems = contentDiv.getElementsByTagName('li');
                Array.from(pdfItems).forEach(item => {
                    const text = item.textContent.toLowerCase();
                    const matches = terms.every(term => text.includes(term));
                    item.style.display = matches ? '' : 'none';
                });
            });
        }

        // Inicialización
        function init() {
            renderFolders();
            if (localStorage.getItem('adminMode') === 'true') {
                isAdminMode = true;
                document.body.classList.add('admin-mode');
                document.getElementById('addFolderBtn').style.display = 'inline-block';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('adminLoginBtn').style.display = 'none';
            }
        }

        init();
    </script>
</body>
</html>
